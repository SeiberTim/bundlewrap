<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>bundles/.../items.py - BundleWrap</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../bundlewrap.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">BundleWrap</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link"><i class="fa fa-home"></i></a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Guides</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../guide/quickstart/" class="dropdown-item">Quickstart</a>
</li>
                                    
<li>
    <a href="../../guide/installation/" class="dropdown-item">Installation</a>
</li>
                                    
<li>
    <a href="../../guide/cli/" class="dropdown-item">CLI</a>
</li>
                                    
<li>
    <a href="../../guide/env/" class="dropdown-item">Environment Variables</a>
</li>
                                    
<li>
    <a href="../../guide/item_file_templates/" class="dropdown-item">File templates</a>
</li>
                                    
<li>
    <a href="../../guide/secrets/" class="dropdown-item">Handling secrets</a>
</li>
                                    
<li>
    <a href="../../guide/locks/" class="dropdown-item">Locking</a>
</li>
                                    
<li>
    <a href="../../guide/kubernetes/" class="dropdown-item">Kubernetes</a>
</li>
                                    
<li>
    <a href="../../guide/dev_item/" class="dropdown-item">Custom items</a>
</li>
                                    
<li>
    <a href="../../guide/api/" class="dropdown-item">Python API</a>
</li>
                                    
<li>
    <a href="../../guide/os_compatibility/" class="dropdown-item">OS compatibility</a>
</li>
                                    
<li>
    <a href="../../guide/toml/" class="dropdown-item">TOML nodes and groups</a>
</li>
                                    
<li>
    <a href="../../guide/selectors/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_12/" class="dropdown-item">Migrating to 2.0</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_23/" class="dropdown-item">Migrating to 3.0</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_34/" class="dropdown-item">Migrating to 4.0</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Repository</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../layout/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../nodes.py/" class="dropdown-item">nodes.py</a>
</li>
                                    
<li>
    <a href="../groups.py/" class="dropdown-item">groups.py</a>
</li>
                                    
<li>
    <a href="../requirements.txt/" class="dropdown-item">requirements.txt</a>
</li>
                                    
<li>
    <a href="../bundle.py/" class="dropdown-item">bundles/.../bundle.py</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">bundles/.../items.py</a>
</li>
                                    
<li>
    <a href="../metadata.py/" class="dropdown-item">bundles/.../metadata.py</a>
</li>
                                    
<li>
    <a href="../hooks/" class="dropdown-item">hooks/</a>
</li>
                                    
<li>
    <a href="../libs/" class="dropdown-item">libs/</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Items</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../items/action/" class="dropdown-item">action</a>
</li>
                                    
<li>
    <a href="../../items/dconf/" class="dropdown-item">dconf</a>
</li>
                                    
<li>
    <a href="../../items/directory/" class="dropdown-item">directory</a>
</li>
                                    
<li>
    <a href="../../items/file/" class="dropdown-item">file</a>
</li>
                                    
<li>
    <a href="../../items/git_deploy/" class="dropdown-item">git_deploy</a>
</li>
                                    
<li>
    <a href="../../items/group/" class="dropdown-item">group</a>
</li>
                                    
<li>
    <a href="../../items/k8s/" class="dropdown-item">k8s_*</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apk/" class="dropdown-item">pkg_apk</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apt/" class="dropdown-item">pkg_apt</a>
</li>
                                    
<li>
    <a href="../../items/pkg_dnf/" class="dropdown-item">pkg_dnf</a>
</li>
                                    
<li>
    <a href="../../items/pkg_freebsd/" class="dropdown-item">pkg_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_openbsd/" class="dropdown-item">pkg_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_opkg/" class="dropdown-item">pkg_opkg</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pacman/" class="dropdown-item">pkg_pacman</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pamac/" class="dropdown-item">pkg_pamac</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pip/" class="dropdown-item">pkg_pip</a>
</li>
                                    
<li>
    <a href="../../items/pkg_snap/" class="dropdown-item">pkg_snap</a>
</li>
                                    
<li>
    <a href="../../items/pkg_yum/" class="dropdown-item">pkg_yum</a>
</li>
                                    
<li>
    <a href="../../items/pkg_zypper/" class="dropdown-item">pkg_zypper</a>
</li>
                                    
<li>
    <a href="../../items/postgres_db/" class="dropdown-item">postgres_db</a>
</li>
                                    
<li>
    <a href="../../items/postgres_role/" class="dropdown-item">postgres_role</a>
</li>
                                    
<li>
    <a href="../../items/routeros/" class="dropdown-item">routeros</a>
</li>
                                    
<li>
    <a href="../../items/svc_freebsd/" class="dropdown-item">svc_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openbsd/" class="dropdown-item">svc_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openrc/" class="dropdown-item">svc_openrc</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemd/" class="dropdown-item">svc_systemd</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemv/" class="dropdown-item">svc_systemv</a>
</li>
                                    
<li>
    <a href="../../items/svc_upstart/" class="dropdown-item">svc_upstart</a>
</li>
                                    
<li>
    <a href="../../items/symlink/" class="dropdown-item">symlink</a>
</li>
                                    
<li>
    <a href="../../items/user/" class="dropdown-item">user</a>
</li>
                                    
<li>
    <a href="../../items/zfs_dataset/" class="dropdown-item">zfs_dataset</a>
</li>
                                    
<li>
    <a href="../../items/zfs_pool/" class="dropdown-item">zfs_pool</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Misc</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../misc/about/" class="dropdown-item">About</a>
</li>
                                    
<li>
    <a href="../../misc/deciding/" class="dropdown-item">Why BundleWrap</a>
</li>
                                    
<li>
    <a href="../../misc/glossary/" class="dropdown-item">Glossary</a>
</li>
                                    
<li>
    <a href="../../misc/faq/" class="dropdown-item">FAQ</a>
</li>
                                    
<li>
    <a href="../../misc/contributing/" class="dropdown-item">Contributing</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../bundle.py/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../metadata.py/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/repo/items.py.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#item-types" class="nav-link">Item types</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#builtin-item-attributes" class="nav-link">Builtin item attributes</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#after" class="nav-link">after</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#before" class="nav-link">before</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#comment" class="nav-link">comment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#error_on_missing_fault" class="nav-link">error_on_missing_fault</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#needs" class="nav-link">needs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#needed_by" class="nav-link">needed_by</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#tags" class="nav-link">tags</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#triggers-and-triggered" class="nav-link">triggers and triggered</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#preceded_by" class="nav-link">preceded_by</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#skip" class="nav-link">skip</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#unless" class="nav-link">unless</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cascade_skip" class="nav-link">cascade_skip</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#when_creating" class="nav-link">when_creating</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#canned-actions" class="nav-link">Canned actions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1>items.py</h1>

<p>Within each bundle, there may be a file called <code>items.py</code>. It defines any number of magic attributes that are automatically processed by BundleWrap. Each attribute is a dictionary mapping an item name (such as a file name) to a dictionary of attributes (e.g. file ownership information).</p>
<p>A typical <code>items.py</code> might look like this:</p>
<pre><code>files = {
    '/etc/hosts': {
         'owner': "root",
         'group': "root",
         'mode': "0664",
         [...]
    },
}

users = {
    'janedoe': {
        'home': "/home/janedoe",
        'shell': "/bin/zsh",
        [...]
    },
    'johndoe': {
        'home': "/home/johndoe",
        'shell': "/bin/bash",
        [...]
    },
}
</code></pre>
<p>This bundle defines the attributes <code>files</code> and <code>users</code>. Within the <code>users</code> attribute, there are two <code>user</code> items. Each item maps its name to a dictionary that is understood by the specific kind of item. Below you will find a reference of all builtin item types and the attributes they understand. You can also <a href="../../guide/dev_item/">define your own item types</a>.</p>
<p><br></p>
<h1 id="item-types">Item types</h1>
<p>This table lists all item types included in BundleWrap along with the bundle attributes they understand.</p>
<table>
<tr><th>Type</th><th>Bundle attribute</th><th>Description</th></tr>
<tr><td><a href="../../items/action">action</a></td><td><code>actions</code></td><td>Actions allow you to run commands on every <code>bw apply</code></td></tr>
<tr><td><a href="../../items/directory">directory</a></td><td><code>directories</code></td><td>Manages permissions and ownership for directories</td></tr>
<tr><td><a href="../../items/file">file</a></td><td><code>files</code></td><td>Manages contents, permissions, and ownership for files</td></tr>
<tr><td><a href="../../items/git_deploy">git_deploy</a></td><td><code>git_deploy</code></td><td>Deploys the contents of a git repository</td></tr>
<tr><td><a href="../../items/group">group</a></td><td><code>groups</code></td><td>Manages groups by wrapping <code>groupadd</code>, <code>groupmod</code> and <code>groupdel</code></td></tr>
<tr><td><a href="../../items/k8s">k8s_*</a></td><td><code>k8s_*</code></td><td>Manages resources in Kubernetes clusters by wrapping <code>kubectl</code></td></tr>
<tr><td><a href="../../items/pkg_apt">pkg_apt</a></td><td><code>pkg_apt</code></td><td>Installs and removes packages with APT</td></tr>
<tr><td><a href="../../items/pkg_dnf">pkg_dnf</a></td><td><code>pkg_dnf</code></td><td>Installs and removes packages with dnf</td></tr>
<tr><td><a href="../../items/pkg_opkg">pkg_opkg</a></td><td><code>pkg_opkg</code></td><td>Installs and removes packages with opkg</td></tr>
<tr><td><a href="../../items/pkg_pacman">pkg_pacman</a></td><td><code>pkg_pacman</code></td><td>Installs and removes packages with pacman</td></tr>
<tr><td><a href="../../items/pkg_pamac">pkg_pamac</a></td><td><code>pkg_pamac</code></td><td>Installs and removes packages with pamac</td></tr>
<tr><td><a href="../../items/pkg_pip">pkg_pip</a></td><td><code>pkg_pip</code></td><td>Installs and removes Python packages with pip</td></tr>
<tr><td><a href="../../items/pkg_snap">pkg_snap</a></td><td><code>pkg_snap</code></td><td>Installs and removes packages with snap</td></tr>
<tr><td><a href="../../items/pkg_yum">pkg_yum</a></td><td><code>pkg_yum</code></td><td>Installs and removes packages with yum</td></tr>
<tr><td><a href="../../items/pkg_zypper">pkg_zypper</a></td><td><code>pkg_zypper</code></td><td>Installs and removes packages with zypper</td></tr>
<tr><td><a href="../../items/postgres_db">postgres_db</a></td><td><code>postgres_dbs</code></td><td>Manages Postgres databases</td></tr>
<tr><td><a href="../../items/postgres_role">postgres_role</a></td><td><code>postgres_roles</code></td><td>Manages Postgres roles</td></tr>
<tr><td><a href="../../items/pkg_pip">pkg_pip</a></td><td><code>pkg_pip</code></td><td>Installs and removes Python packages with pip</td></tr>
<tr><td><a href="../../items/pkg_freebsd">pkg_freebsd</a></td><td><code>pkg_freebsd</code></td><td>Installs and removes FreeBSD packages with pkg</td></tr>
<tr><td><a href="../../items/pkg_openbsd">pkg_openbsd</a></td><td><code>pkg_openbsd</code></td><td>Installs and removes OpenBSD packages with pkg_add/pkg_delete</td></tr>
<tr><td><a href="../../items/routeros">routeros</a></td><td><code>routeros</code></td><td>Manages RouterOS configuration</td></tr>
<tr><td><a href="../../items/svc_freebsd">svc_freebsd</a></td><td><code>svc_freebsd</code></td><td>Starts and stops services with FreeBSD's rc</td></tr>
<tr><td><a href="../../items/svc_openbsd">svc_openbsd</a></td><td><code>svc_openbsd</code></td><td>Starts and stops services with OpenBSD's rc</td></tr>
<tr><td><a href="../../items/svc_systemd">svc_systemd</a></td><td><code>svc_systemd</code></td><td>Starts and stops services with systemd</td></tr>
<tr><td><a href="../../items/svc_systemv">svc_systemv</a></td><td><code>svc_systemv</code></td><td>Starts and stops services with traditional System V init scripts</td></tr>
<tr><td><a href="../../items/svc_upstart">svc_upstart</a></td><td><code>svc_upstart</code></td><td>Starts and stops services with Upstart</td></tr>
<tr><td><a href="../../items/symlink">symlink</a></td><td><code>symlinks</code></td><td>Manages symbolic links and their ownership</td></tr>
<tr><td><a href="../../items/user">user</a></td><td><code>users</code></td><td>Manages users by wrapping <code>useradd</code>, <code>usermod</code> and <code>userdel</code></td></tr>
<tr><td><a href="../../items/zfs_dataset">zfs_dataset</a></td><td><code>zfs_datasets</code></td><td>Manages ZFS datasets</td></tr>
<tr><td><a href="../../items/zfs_pool">zfs_pool</a></td><td><code>zfs_pools</code></td><td>Manages ZFS pools</td></tr>
</table>

<p><br></p>
<h1 id="builtin-item-attributes">Builtin item attributes</h1>
<p>There are also attributes that can be applied to any kind of item.</p>
<p><br></p>
<h2 id="after">after</h2>
<p>This lets you control execution order of items. This is not something you will have to do very often, because there are already implicit dependencies between item types (e.g. all files automatically depend on the users owning them).</p>
<pre><code>actions = {
    'a': {
        'command': 'true',
    },
    'b': {
        'command': 'true',
        'after': {'action:a'},
    },
}
</code></pre>
<p>When set up like this, <code>action:b</code> will only run after <code>action:a</code> has been completed. Note that it doesn't matter if <code>action:a</code> is successful or not, that what <code>needs</code> is for.</p>
<p>See <a href="../../guide/selectors/">Selectors</a> for a complete overview of the ways to specify items here.</p>
<p><br></p>
<h2 id="before">before</h2>
<p>Just like <code>after</code>, but in the opposite direction.</p>
<p><br></p>
<h2 id="comment">comment</h2>
<p>This is a string that will be displayed in interactive mode (<code>bw apply -i</code>) whenever the item is to be changed in any way. You can use it to warn users before they start disruptive actions.</p>
<p><br></p>
<h2 id="error_on_missing_fault">error_on_missing_fault</h2>
<p>This will simply skip an item instead of raising an error when a Fault used for an attribute on the item is unavailable. Faults are special objects used by <code>repo.vault</code> to <a href="../../guide/secrets/">handle secrets</a>. A Fault being unavailable can mean you're missing the secret key required to decrypt a secret you're trying to use as an item attribute value.</p>
<p>Defaults to <code>False</code>.</p>
<p><br></p>
<h2 id="needs">needs</h2>
<p>This allows for setting up dependencies between items. Here are two examples:</p>
<pre><code>my_items = {
    'item1': {
        [...]
        'needs': [
            'file:/etc/foo.conf',
        ],
    },
    'item2': {
        [...]
        'needs': [
            'pkg_apt:',
            'bundle:foo',
        ],
    }
}
</code></pre>
<p>The first item (<code>item1</code>, specific attributes have been omitted) depends on a file called <code>/etc/foo.conf</code>, while <code>item2</code> depends on all APT packages being installed and every item in the foo bundle.</p>
<p>Note that unlike <code>after</code>, with <code>needs</code> the depending item will be skipped if the item it depends on fails or is skipped (unless <code>cascade_skip</code> is set to <code>False</code> on that item).</p>
<p>See <a href="../../guide/selectors/">Selectors</a> for a complete overview of the ways to specify items here.</p>
<p><br></p>
<h2 id="needed_by">needed_by</h2>
<p>This attribute is an alternative way of defining dependencies. It works just like <code>needs</code>, but in the other direction. There are only three scenarios where you should use <code>needed_by</code> over <code>needs</code>:</p>
<ul>
<li>if you need all items of a certain type to depend on something or</li>
<li>if you need all items in a bundle to depend on something or</li>
<li>if you need an item in a bundle you can't edit to depend on something in your bundles</li>
</ul>
<p><br></p>
<h2 id="tags">tags</h2>
<p>A list of strings to tag an item with. Tagging has no immediate effect in itself, but can be useful in a number of places. For example, you can add dependencies on all items with a given tag:</p>
<pre><code>pkg_apt = {
    "mysql-server-{}".format(node.metadata.get('mysql_version', "5.5")): {
        'tags': ["provides-mysqld"],
    },
}

svc_systemd = {
    "myapp": {
        'needs': ["tag:provides-mysqld"],
    },
}
</code></pre>
<p>In this simplified example we save ourselves from duplicating the logic that gets the current MySQL version from metadata (which is probably overkill here, but you might encounter more complex situations).</p>
<p>Tags also allow for optional dependencies, since items can depend on tags that don't exist. So for example if you need to do something after items from another bundle have been completed, but that bundle might not always be there, you can depend on a tag given to the items of the other bundle.</p>
<p><br></p>
<h2 id="triggers-and-triggered">triggers and triggered</h2>
<p>In some scenarios, you may want to execute an <a href="../../items/action/">action</a> only when an item is fixed (e.g. restart a daemon after a config file has changed or run <code>postmap</code> after updating an alias file). To do this, BundleWrap has the builtin atttribute <code>triggers</code>. You can use it to point to any item that has its <code>triggered</code> attribute set to <code>True</code>. Such items will only be checked (or in the case of actions: run) if the triggering item is fixed (or a triggering action completes successfully).</p>
<pre><code>files = {
    '/etc/daemon.conf': {
        [...]
        'triggers': [
            'action:restart_daemon',
        ],
    },
}

actions = {
    'restart_daemon': {
        'command': "service daemon restart",
        'triggered': True,
    },
}
</code></pre>
<p>The above example will run <code>service daemon restart</code> every time BundleWrap successfully applies a change to <code>/etc/daemon.conf</code>. If an action is triggered multiple times, it will only be run once.</p>
<p>Similar to <code>needed_by</code>, <code>triggered_by</code> can be used to define a <code>triggers</code> relationship from the opposite direction.</p>
<p>See <a href="../../guide/selectors/">Selectors</a> for a complete overview of the ways to specify items here.</p>
<p><br></p>
<h2 id="preceded_by">preceded_by</h2>
<p>Operates like <code>triggers</code>, but will apply the triggered item <em>before</em> the triggering item. Let's look at an example:</p>
<pre><code>files = {
    '/etc/example.conf': {
        [...]
        'preceded_by': [
            'action:backup_example',
        ],
    },
}

actions = {
    'backup_example': {
        'command': "cp /etc/example.conf /etc/example.conf.bak",
        'triggered': True,
    },
}
</code></pre>
<p>In this configuration, <code>/etc/example.conf</code> will always be copied before and only if it is changed. You would probably also want to set <code>cascade_skip</code> to <code>False</code> on the action so you can skip it in interactive mode when you're sure you don't need the backup copy.</p>
<p>Similar to <code>needed_by</code>, <code>precedes</code> can be used to define a <code>preceded_by</code> relationship from the opposite direction.</p>
<p>See <a href="../../guide/selectors/">Selectors</a> for a complete overview of the ways to specify items here.</p>
<p><br></p>
<h2 id="skip">skip</h2>
<p>Set this to <code>True</code> to always skip this item. This is useful if you just want to quickly disable this item to try something or if it's sitting somewhere in a dependency chain and it would be too cumbersome to remove entirely under certain conditions. Note that setting this to <code>True</code> will also change the default for <code>cascade_skip</code> to <code>False</code>.</p>
<p><br></p>
<h2 id="unless">unless</h2>
<p>Another builtin item attribute is <code>unless</code>. For example, it can be used to construct a one-off file item where BundleWrap will only create the file once, but won't check or modify its contents once it exists.</p>
<pre><code>files = {
    "/path/to/file": {
        [...]
        "unless": "test -x /path/to/file",
    },
}
</code></pre>
<p>This will run <code>test -x /path/to/file</code> before doing anything with the item. If the command returns 0, no action will be taken to "correct" the item.</p>
<p>Another common use for <code>unless</code> is with actions that perform some sort of install operation. In this case, the <code>unless</code> condition makes sure the install operation is only performed when it is needed instead of every time you run <code>bw apply</code>. In scenarios like this you will probably want to set <code>cascade_skip</code> to <code>False</code> so that skipping the installation (because the thing is already installed) will not cause every item that depends on the installed thing to be skipped. Example:</p>
<pre><code>actions = {
    'download_thing': {
        'command': "wget http://example.com/thing.bin -O /opt/thing.bin &amp;&amp; chmod +x /opt/thing.bin",
        'unless': "test -x /opt/thing.bin",
        'cascade_skip': False,
    },
    'run_thing': {
        'command': "/opt/thing.bin",
        'needs': ["action:download_thing"],
    },
}
</code></pre>
<p>If <code>action:download_thing</code> would not set <code>cascade_skip</code> to <code>False</code>, <code>action:run_thing</code> would only be executed once: directly after the thing has been downloaded. On subsequent runs, <code>action:download_thing</code> will fail the <code>unless</code> condition and be skipped. This would also cause all items that depend on it to be skipped, including <code>action:run_thing</code>.</p>
<div class="alert alert-warning">The commands you choose for <code>unless</code> should not change the state of your node. Otherwise, running <code>bw verify</code> might unexpectedly interfere with your nodes.</div>

<p><br></p>
<h2 id="cascade_skip">cascade_skip</h2>
<p>DEPRECATED: Use <code>before</code> and <code>after</code> instead.</p>
<p>There are some situations where you don't want to default behavior of skipping everything that depends on a skipped item. That's where <code>cascade_skip</code> comes in. Set it to <code>False</code> and skipping an item won't skip those that depend on it. Note that items can be skipped</p>
<ul>
<li>interactively or</li>
<li>because of <code>bw apply --only</code> or <code>bw apply --skip</code> or</li>
<li>because a Fault was unavailable or</li>
<li>they were soft-locked on the node or</li>
<li>because they haven't been triggered or</li>
<li>because one of their dependencies was skipped or</li>
<li>because one of their dependencies failed or</li>
<li>they failed their <code>unless</code> condition or</li>
<li>the <code>skip</code> attribute was set or</li>
<li>because an <a href="../../items/action/">action</a> had its <code>interactive</code> attribute set to <code>True</code> during a non-interactive run</li>
</ul>
<p>The following example will offer to run an <code>apt-get update</code> before installing a package, but continue to install the package even if the update is declined interactively.</p>
<pre><code>actions = {
    'apt_update': {
        'cascade_skip': False,
        'command': "apt-get update",
    },
}

pkg_apt = {
    'somepkg': {
        'needs': ["action:apt_update"],
    },
}
</code></pre>
<p><code>cascade_skip</code> defaults to <code>True</code>. However, if the item uses the <code>unless</code> or <code>skip</code> attributes or is triggered, the default changes to <code>False</code>. Most of the time, this is what you'll want.</p>
<p><br></p>
<h2 id="when_creating">when_creating</h2>
<p>These attributes are only enforced during the creation of the item on the node (this means the first run of <code>bw apply</code> after adding this item to config). They are ignored in subsequent runs of <code>bw apply</code>, and when other (non-when_creating) attributes are changed.</p>
<h1 id="canned-actions">Canned actions</h1>
<p>Some item types have what we call "canned actions". Those are pre-defined actions attached directly to an item. Take a look at this example:</p>
<pre><code>svc_upstart = {'mysql': {'running': True}}

files = {
    "/etc/mysql/my.cnf": {
        'source': "my.cnf",
        'triggers': [
            "svc_upstart:mysql:reload",  # this triggers the canned action
        ],
    },
}
</code></pre>
<p>Canned actions always have to be triggered in order to run. In the example above, a change in the file <code>/etc/mysql/my.cnf</code> will trigger the <code>reload</code> action defined by the <a href="../../items/svc_upstart/">svc_upstart item type</a> for the mysql service.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
