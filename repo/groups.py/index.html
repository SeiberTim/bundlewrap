<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>groups.py - BundleWrap</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../bundlewrap.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">BundleWrap</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link"><i class="fa fa-home"></i></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../guide/quickstart/" class="dropdown-item">Quickstart</a>
</li>
                                    
<li>
    <a href="../../guide/installation/" class="dropdown-item">Installation</a>
</li>
                                    
<li>
    <a href="../../guide/cli/" class="dropdown-item">CLI</a>
</li>
                                    
<li>
    <a href="../../guide/env/" class="dropdown-item">Environment Variables</a>
</li>
                                    
<li>
    <a href="../../guide/item_file_templates/" class="dropdown-item">File templates</a>
</li>
                                    
<li>
    <a href="../../guide/secrets/" class="dropdown-item">Handling secrets</a>
</li>
                                    
<li>
    <a href="../../guide/locks/" class="dropdown-item">Locking</a>
</li>
                                    
<li>
    <a href="../../guide/kubernetes/" class="dropdown-item">Kubernetes</a>
</li>
                                    
<li>
    <a href="../../guide/dev_item/" class="dropdown-item">Custom items</a>
</li>
                                    
<li>
    <a href="../../guide/api/" class="dropdown-item">Python API</a>
</li>
                                    
<li>
    <a href="../../guide/os_compatibility/" class="dropdown-item">OS compatibility</a>
</li>
                                    
<li>
    <a href="../../guide/toml/" class="dropdown-item">TOML nodes and groups</a>
</li>
                                    
<li>
    <a href="../../guide/selectors/" class="dropdown-item">Selectors</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_12/" class="dropdown-item">Migrating to 2.0</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_23/" class="dropdown-item">Migrating to 3.0</a>
</li>
                                    
<li>
    <a href="../../guide/migrate_34/" class="dropdown-item">Migrating to 4.0</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../layout/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../nodes.py/" class="dropdown-item">nodes.py</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">groups.py</a>
</li>
                                    
<li>
    <a href="../requirements.txt/" class="dropdown-item">requirements.txt</a>
</li>
                                    
<li>
    <a href="../bundle.py/" class="dropdown-item">bundles/.../bundle.py</a>
</li>
                                    
<li>
    <a href="../items.py/" class="dropdown-item">bundles/.../items.py</a>
</li>
                                    
<li>
    <a href="../metadata.py/" class="dropdown-item">bundles/.../metadata.py</a>
</li>
                                    
<li>
    <a href="../hooks/" class="dropdown-item">hooks/</a>
</li>
                                    
<li>
    <a href="../libs/" class="dropdown-item">libs/</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../items/action/" class="dropdown-item">action</a>
</li>
                                    
<li>
    <a href="../../items/dconf/" class="dropdown-item">dconf</a>
</li>
                                    
<li>
    <a href="../../items/directory/" class="dropdown-item">directory</a>
</li>
                                    
<li>
    <a href="../../items/file/" class="dropdown-item">file</a>
</li>
                                    
<li>
    <a href="../../items/git_deploy/" class="dropdown-item">git_deploy</a>
</li>
                                    
<li>
    <a href="../../items/group/" class="dropdown-item">group</a>
</li>
                                    
<li>
    <a href="../../items/k8s/" class="dropdown-item">k8s_*</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apk/" class="dropdown-item">pkg_apk</a>
</li>
                                    
<li>
    <a href="../../items/pkg_apt/" class="dropdown-item">pkg_apt</a>
</li>
                                    
<li>
    <a href="../../items/pkg_dnf/" class="dropdown-item">pkg_dnf</a>
</li>
                                    
<li>
    <a href="../../items/pkg_freebsd/" class="dropdown-item">pkg_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_openbsd/" class="dropdown-item">pkg_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/pkg_opkg/" class="dropdown-item">pkg_opkg</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pacman/" class="dropdown-item">pkg_pacman</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pamac/" class="dropdown-item">pkg_pamac</a>
</li>
                                    
<li>
    <a href="../../items/pkg_pip/" class="dropdown-item">pkg_pip</a>
</li>
                                    
<li>
    <a href="../../items/pkg_snap/" class="dropdown-item">pkg_snap</a>
</li>
                                    
<li>
    <a href="../../items/pkg_yum/" class="dropdown-item">pkg_yum</a>
</li>
                                    
<li>
    <a href="../../items/pkg_zypper/" class="dropdown-item">pkg_zypper</a>
</li>
                                    
<li>
    <a href="../../items/postgres_db/" class="dropdown-item">postgres_db</a>
</li>
                                    
<li>
    <a href="../../items/postgres_role/" class="dropdown-item">postgres_role</a>
</li>
                                    
<li>
    <a href="../../items/routeros/" class="dropdown-item">routeros</a>
</li>
                                    
<li>
    <a href="../../items/svc_freebsd/" class="dropdown-item">svc_freebsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openbsd/" class="dropdown-item">svc_openbsd</a>
</li>
                                    
<li>
    <a href="../../items/svc_openrc/" class="dropdown-item">svc_openrc</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemd/" class="dropdown-item">svc_systemd</a>
</li>
                                    
<li>
    <a href="../../items/svc_systemv/" class="dropdown-item">svc_systemv</a>
</li>
                                    
<li>
    <a href="../../items/svc_upstart/" class="dropdown-item">svc_upstart</a>
</li>
                                    
<li>
    <a href="../../items/symlink/" class="dropdown-item">symlink</a>
</li>
                                    
<li>
    <a href="../../items/user/" class="dropdown-item">user</a>
</li>
                                    
<li>
    <a href="../../items/zfs_dataset/" class="dropdown-item">zfs_dataset</a>
</li>
                                    
<li>
    <a href="../../items/zfs_pool/" class="dropdown-item">zfs_pool</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../misc/about/" class="dropdown-item">About</a>
</li>
                                    
<li>
    <a href="../../misc/deciding/" class="dropdown-item">Why BundleWrap</a>
</li>
                                    
<li>
    <a href="../../misc/glossary/" class="dropdown-item">Glossary</a>
</li>
                                    
<li>
    <a href="../../misc/faq/" class="dropdown-item">FAQ</a>
</li>
                                    
<li>
    <a href="../../misc/contributing/" class="dropdown-item">Contributing</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../nodes.py/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../requirements.txt/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/repo/groups.py.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#groupspy" class="nav-link">groups.py</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#group-attribute-reference" class="nav-link">Group attribute reference</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#member_patterns" class="nav-link">member_patterns</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#members" class="nav-link">members</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#metadata" class="nav-link">metadata</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#subgroups" class="nav-link">subgroups</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#subgroup_patterns" class="nav-link">subgroup_patterns</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#supergroups" class="nav-link">supergroups</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="groupspy">groups.py</h1>
<p>This file lets you specify or dynamically build groups of <a href="../nodes.py/">nodes</a> in your environment.</p>
<p>As with <code>nodes.py</code>, you define your groups as a dictionary:</p>
<pre><code>groups = {
    'all': {
        'member_patterns': (
            r".*",
        ),
    },
    'group1': {
        'members': (
            'node1',
        ),
    },
}
</code></pre>
<p>All group attributes are optional.</p>
<p><br></p>
<h1 id="group-attribute-reference">Group attribute reference</h1>
<p>This section is a reference for all possible attributes you can define for a group:</p>
<pre><code>groups = {
    'group1': {
        # THIS PART IS EXPLAINED HERE
        'bundles': ["bundle1", "bundle2"],
        'members': ["node1"],
        'member_patterns': [r"^cluster1\."],
        'metadata': {'foo': "bar"},
        'os': 'linux',
        'subgroups': ["group2", "group3"],
        'subgroup_patterns': [r"^group.*pattern$"],
    },
}
</code></pre>
<p>Note that many attributes from <a href="../nodes.py/">nodes.py</a> (e.g. <code>bundles</code>) may also be set at group level, but aren't explicitly documented here again.</p>
<p><br></p>
<h2 id="member_patterns">member_patterns</h2>
<p>A list of regular expressions. Node names matching these expressions will be added to the group members.</p>
<p>Matches are determined using <a href="http://docs.python.org/2/library/re.html#re.RegexObject.search">the search() method</a>.</p>
<p><br></p>
<h2 id="members">members</h2>
<p>A tuple or list of node names that belong to this group.</p>
<p><br></p>
<h2 id="metadata">metadata</h2>
<p>A dictionary that will be accessible from each node's <code>node.metadata</code>. For each node, BundleWrap will merge the metadata of all of the node's groups first, then merge in the metadata from the node itself.</p>
<p>Metadata is merged recursively by default, meaning nested dicts will overlay each other. Lists will be appended to each other, but not recursed into. In come cases, you want to overwrite instead of merge a piece of metadata. This is accomplished through the use of <code>bundlewrap.metadata.atomic()</code> and best illustrated as an example:</p>
<pre><code>from bundlewrap.metadata import atomic

groups = {
    'all': {
        'metadata': {
            'interfaces': {
                'eth0': {},
            },
            'nameservers': ["8.8.8.8", "8.8.4.4"],
            'ntp_servers': ["pool.ntp.org"],
        },
    },
    'internal': {
        'metadata':
            'interfaces': {
                'eth1': {},
            },
            'nameservers': atomic(["10.0.0.1", "10.0.0.2"]),
            'ntp_servers': ["10.0.0.1", "10.0.0.2"],
        },
    },
}
</code></pre>
<p>A node in both groups will end up with <code>eth0</code> <em>and</em> <code>eth1</code>.</p>
<p>The nameservers however are overwritten, so that nodes that are in both the "all" <em>and</em> the "internal" group will only have the <code>10.0.0.x</code> ones while nodes just in the "all" group will have the <code>8.8.x.x</code> nameservers.</p>
<p>The NTP servers are appended: a node in both groups will have all three of them.</p>
<div class="alert alert-warning">BundleWrap will consider group hierarchy when merging metadata. For example, it is possible to define a default nameserver for the "eu" group and then override it for the "eu.frankfurt" subgroup. The catch is that this only works for groups that are connected through a subgroup hierarchy. Independent groups will have their metadata merged in an undefined order. <code>bw test</code> will report conflicting metadata in independent groups as a metadata collision.</div>

<div class="alert alert-info">Also see the <a href="../nodes.py#metadata">documentation for node.metadata</a> and <a href="../metadata.py#Priority">metadata.py</a> for more information.</div>

<p><br></p>
<h2 id="subgroups">subgroups</h2>
<p>A tuple or list of group names whose members should be recursively included in this group.</p>
<p><br></p>
<h2 id="subgroup_patterns">subgroup_patterns</h2>
<p>A list of regular expressions. Nodes in with group names matching these expressions will be added to the group members.</p>
<p>Matches are determined using <a href="http://docs.python.org/2/library/re.html#re.RegexObject.search">the search() method</a>.</p>
<p><br></p>
<h2 id="supergroups">supergroups</h2>
<p>The inverse of <code>subgroups</code>. Nodes in this group will be added to all supergroups.</p>
<p><br></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p><p> Donations welcome in Bitcoin <code>13AJYksqncZromPF8HvDUXsmHChAm3Y7W7</code> or Ethereum <code>0x5Eb3037e197d3C0d2E014bcfC2e027EB0AD42812</code>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
